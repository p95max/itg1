{% extends 'news/base.html' %}
{% load i18n %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
<section>

  {# Tabs #}
  <ul class="nav nav-tabs" id="addArticleTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="article-tab" data-bs-toggle="tab" data-bs-target="#article" type="button" role="tab">
        {% trans '–°—Ç–∞—Ç—å—è' %}
      </button>
    </li>
    {% if user.is_authenticated %}
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments" type="button" role="tab">
        {% trans '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏' %} ({{ article.comments.count }})
      </button>
    </li>
    {% else %}
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments" type="button" role="tab" disabled>
        {% trans '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏' %}
      </button>
    </li>
    {% endif %}
  </ul>

  <div class="tab-content mt-3">

    {# Tab ---------------------------------------- article #}
    <div class="tab-pane fade show active" id="article" role="tabpanel">
      <div class="news">
        <h2>{{ article.title }}</h2>
        {% if article.image %}
          <img src="{{ article.image.url }}" alt="{{ article.title }}" class="img-fluid mb-3">
        {% endif %}

        <p>{{ article.content }} </p>

        {# Tags #}
        {% if article.tags.all %}
          <p><strong>{% trans "–¢–µ–≥–∏:"  %}</strong></p>
          <ul>
            {% for tag in article.tags.all %}
              <li><a href="{% url 'news:news_by_tag' tag.name %}">{{ tag.name }}</a></li>
            {% endfor %}
          </ul>
        {% endif %}

        {# Category #}
        <p><strong>{% trans '–ö–∞—Ç–µ–≥–æ—Ä–∏—è:'  %}</strong>
          {% if article.category %}
            <a href="{% url 'news:news_by_category' article.category.name %}">{{ article.category.name }}</a>
          {% else %}
           {% trans '–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'  %}
          {% endif %}
        </p>

        {# Likes and favourites #}
        <div class="buttons-container d-flex gap-3 mb-3">
          <form id="like-form-{{ article.id }}" data-article-id="{{ article.id }}">
            {% csrf_token %}
            <button type="button" class="btn {% if request.META.REMOTE_ADDR in liked_ips %}btn-success{% else %}btn-outline-success{% endif %} {% if not user.is_authenticated %}btn-secondary disabled{% endif %}" id="like-btn-{{ article.id }}">
             {% trans 'üëç –ù—Ä–∞–≤–∏—Ç—Å—è'  %} <span id="like-count-{{ article.id }}">{{ article.likes_count }}</span>
            </button>
          </form>

          <form id="favourite-form-{{ article.id }}" data-article-id="{{ article.id }}">
            {% csrf_token %}
            <button type="button" class="btn {% if request.META.REMOTE_ADDR in favourite_ips %}btn-warning{% else %}btn-outline-warning{% endif %} {% if not user.is_authenticated %}btn-secondary disabled{% endif %}" id="favourite-btn-{{ article.id }}">
              {% trans '‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'  %} <span id="favourite-count-{{ article.id }}">{{ article.favourites_count }}</span>
            </button>
          </form>
        </div>

        <p> {% trans 'üëÅ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏:'  %} '{{ article.views }}' </p>

        {# Share article #}
<button type="button" onclick="copyToClipboard()">üìã–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>

        {# Similar articles#}
        <hr>
        <h3>{% trans '–ü–æ—Ö–æ–∂–∏–µ —Å—Ç–∞—Ç—å–∏'  %}</h3>
        <ul>
          {% for sim in similar_articles %}
            <li>
              <a href="{% url 'news:article_detail' slug=sim.slug %}">{{ sim.title }}</a>
            </li>
          {% empty %}
            <p> {% trans '–ü–æ—Ö–æ–∂–∏–µ —Å—Ç–∞—Ç—å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' %} </p>
          {% endfor %}
        </ul>

        <a class="btn btn-secondary mt-3" href="{% url 'news:catalog' %}">{% trans '‚Üê –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–π'  %}</a>
      </div>
    </div>

    {# Tab -------------------------------- Comments #}
    <div class="tab-pane fade" id="comments" role="tabpanel">
      {% if user.is_authenticated %}
        <h5 class="mt-5 mb-3">{% trans 'üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:'  %}</h5>
        {% if article.comments.all %}
          <div class="list-group">
            {% for comment in article.comments.all %}
              <div class="list-group-item">
                <h6 class="mb-1">{{ comment.name }}</h6>
                <p class="mb-1">{{ comment.text }}</p>
                <small class="text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p>{% trans '–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤'  %}</p>
        {% endif %}

        <form method="post" class="mb-4 mt-3">
          {% csrf_token %}
          <div class="mb-3">
            <label for="name" class="form-label">{% trans '–ò–º—è ' %}</label>
            <input type="text" class="form-control" id="name" name="name" placeholder={% trans "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"  %} required>
          </div>
          <div class="mb-3">
            <label for="text" class="form-label">{% trans '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'  %} </label>
            <textarea class="form-control" id="text" name="text" rows="4" placeholder={% trans "–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."  %} required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">{% trans '–û—Ç–ø—Ä–∞–≤–∏—Ç—å'  %}</button>
        </form>
      {% else %}
        <p>{% trans '–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ—é —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å.' %}</p>
      {% endif %}
    </div>
  </div>

</section>
{% endblock %}
