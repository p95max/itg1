{% extends 'news/base.html' %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
<section class="news">
    <h2>{{ article.title }}</h2>
{% if article.image %}
    <img src="{{ article.image.url }}" alt="{{ article.title }}" class="img-fluid mb-3">
{% endif %}

    <p>{{ article.content }}</p>

    {# –¢–µ–≥–∏ #}
    {% if article.tags.all %}
        <p><strong>–¢–µ–≥–∏:</strong></p>
        <ul>
            {% for tag in article.tags.all %}
                <li><a href="{% url 'news:news_by_tag' tag.name %}">{{ tag.name }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}

    {# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ #}
    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
        {% if article.category %}
            <a href="{% url 'news:news_by_category' article.category.name %}">{{ article.category.name }}</a>
        {% else %}
            –ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        {% endif %}
    </p>

    {# –õ–∞–π–∫–∏ –∏ –∑–∞–∫–ª–∞–¥–∫–∏ #}
    <div class="buttons-container d-flex gap-3">
        {# –õ–∞–π–∫ #}
        <form id="like-form-{{ article.id }}" data-article-id="{{ article.id }}">
            {% csrf_token %}
            <button type="button" class="btn {% if request.META.REMOTE_ADDR in liked_ips %}btn-success{% else %}btn-outline-success{% endif %}" id="like-btn-{{ article.id }}">
                üëç –ù—Ä–∞–≤–∏—Ç—Å—è <span id="like-count-{{ article.id }}">{{ article.likes_count }}</span>
            </button>
        </form>

        {# –ó–∞–∫–ª–∞–¥–∫–∏ #}
        <form id="favourite-form-{{ article.id }}" data-article-id="{{ article.id }}">
            {% csrf_token %}
                <button type="button" class="btn {% if request.META.REMOTE_ADDR in favourite_ips %}btn-warning
                {% else %}btn-outline-warning{% endif %}" id="favourite-btn-{{ article.id }}">
                ‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ <span id="favourite-count-{{ article.id }}">{{ article.favourites_count }}</span>
            </button>
        </form>
    </div>

    <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏: {{ article.views }}</p>

    {# –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ #}
    <form method="post" class="mb-4">
        {% csrf_token %}
        <div class="mb-3">
            <label for="name" class="form-label">–ò–º—è</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required>
        </div>
        <div class="mb-3">
            <label for="text" class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
            <textarea class="form-control" id="text" name="text" rows="4" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

    <h5 class="mt-5 mb-3">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h5>
    {% if article.comments.all %}
        <div class="list-group">
            {% for comment in article.comments.all %}
                <div class="list-group-item">
                    <h6 class="mb-1">{{ comment.name }}</h6>
                    <p class="mb-1">{{ comment.text }}</p>
                    <small class="text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
    {% endif %}

{#    –ü–æ—Ö–æ–∂–∏–µ —Å—Ç–∞—Ç—å–∏#}
    <hr>
    <h3>–ü–æ—Ö–æ–∂–∏–µ —Å—Ç–∞—Ç—å–∏</h3>
    <ul>
      {% for sim in similar_articles %}
        <li>
          <a href="{% url 'news:article_detail' slug=sim.slug %}">
            {{ sim.title }}
          </a>
        </li>
      {% empty %}
        <p>–ü–æ—Ö–æ–∂–∏–µ —Å—Ç–∞—Ç—å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
      {% endfor %}
    </ul>

    <a class="backlink" href="{% url 'news:catalog' %}">‚Üê –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–π</a>
</section>
{% endblock %}
