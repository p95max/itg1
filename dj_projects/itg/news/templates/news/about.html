{% extends 'news/base.html' %}

{% block title %} О нас {% endblock %}

{% block content %}
    <div class="card p-4">
        <h3>{{ title }}</h3>
        <p>{{ description }}</p>

        <h4>Контактная информация</h4>
        <ul class="list-unstyled">
            <li><strong>Email:</strong> {{ contacts.email }}</li>
            <li><strong>Телефон:</strong> {{ contacts.phone }}</li>
            <li><strong>Адрес:</strong> {{ contacts.address }}</li>
        </ul>

        <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#mapModal">
            Показать на карте
        </button>
    </div>

    <!-- Модальное окно с картой -->
    <div class="modal fade" id="mapModal" tabindex="-1" aria-labelledby="mapModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mapModalLabel">{{ company_name }}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                </div>
                <div class="modal-body">
                    <div id="map" style="height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block extra_scripts %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        let map;
        let isMapInitialized = false;

        const modal = document.getElementById('mapModal');
        modal.addEventListener('shown.bs.modal', function () {
            if (!isMapInitialized) {
                setTimeout(function () {
                    map = L.map('map').setView([{{ latitude }}, {{ longitude }}], 15);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; OpenStreetMap contributors'
                    }).addTo(map);
                    L.marker([{{ latitude }}, {{ longitude }}]).addTo(map)
                        .bindPopup("{{ company_name }}")
                        .openPopup();
                    isMapInitialized = true;
                }, 500);  // Добавлена задержка перед инициализацией карты
            } else {
                // Обновляем карту, если она уже инициализирована
                setTimeout(() => {
                    map.invalidateSize();
                }, 100);
            }
        });
    </script>
{% endblock %}
